<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cookie Sniffer 测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .api-section {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .cookie-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>🍪 Cookie Sniffer 功能测试页面</h1>
    
    <div class="test-section">
        <h2>1. 基本Cookie测试</h2>
        <p>点击按钮设置测试Cookie：</p>
        <button class="test-button" onclick="setTestCookie()">设置测试Cookie</button>
        <button class="test-button" onclick="setMultipleCookies()">设置多个Cookie</button>
        <button class="test-button" onclick="clearTestCookies()">清除测试Cookie</button>
        <div id="cookieDisplay" class="cookie-display">当前Cookie: 无</div>
    </div>

    <div class="test-section">
        <h2>2. API路径测试</h2>
        <p>模拟API请求，这些应该被插件捕获：</p>
        <div class="api-section">
            <h3>登录API</h3>
            <button class="test-button" onclick="simulateApiCall('/api/login')">模拟登录API</button>
            <button class="test-button" onclick="simulateApiCall('/api/auth')">模拟认证API</button>
        </div>
        <div class="api-section">
            <h3>会话API</h3>
            <button class="test-button" onclick="simulateApiCall('/api/session')">模拟会话API</button>
            <button class="test-button" onclick="simulateApiCall('/api/user/profile')">模拟用户API</button>
        </div>
    </div>

    <div class="test-section">
        <h2>3. 正则表达式测试</h2>
        <p>测试正则表达式匹配：</p>
        <button class="test-button" onclick="simulateApiCall('https://api.example.com/v1/users')">模拟API v1</button>
        <button class="test-button" onclick="simulateApiCall('https://api.example.com/v2/users')">模拟API v2</button>
        <button class="test-button" onclick="simulateApiCall('https://test.example.com/api/data')">模拟测试API</button>
    </div>

    <div class="test-section">
        <h2>4. 全匹配测试</h2>
        <p>测试完全匹配：</p>
        <button class="test-button" onclick="simulateApiCall('https://exact-match.example.com')">精确匹配测试</button>
        <button class="test-button" onclick="simulateApiCall('https://another-exact.example.com')">另一个精确匹配</button>
    </div>

    <div class="test-section">
        <h2>5. 复杂场景测试</h2>
        <p>模拟复杂的网络请求场景：</p>
        <button class="test-button" onclick="simulateComplexScenario()">模拟复杂场景</button>
        <button class="test-button" onclick="simulateMultipleRequests()">模拟多个请求</button>
    </div>

    <div class="test-section">
        <h2>6. 插件功能验证</h2>
        <p>验证插件的新功能：</p>
        <button class="test-button" onclick="checkPluginStatus()">检查插件状态</button>
        <button class="test-button" onclick="exportTestRules()">导出测试规则</button>
        <div id="pluginStatus" class="cookie-display">插件状态: 未检查</div>
    </div>

    <script>
        // 设置测试Cookie
        function setTestCookie() {
            document.cookie = "test_cookie=test_value_123; path=/";
            document.cookie = "session_id=abc123def456; path=/";
            updateCookieDisplay();
        }

        // 设置多个Cookie
        function setMultipleCookies() {
            document.cookie = "user_id=12345; path=/";
            document.cookie = "auth_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9; path=/";
            document.cookie = "preferences=dark_mode,notifications; path=/";
            updateCookieDisplay();
        }

        // 清除测试Cookie
        function clearTestCookies() {
            document.cookie = "test_cookie=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            document.cookie = "session_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            document.cookie = "user_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            document.cookie = "auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            document.cookie = "preferences=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            updateCookieDisplay();
        }

        // 更新Cookie显示
        function updateCookieDisplay() {
            const cookies = document.cookie;
            document.getElementById('cookieDisplay').textContent = `当前Cookie: ${cookies || '无'}`;
        }

        // 模拟API调用
        function simulateApiCall(url) {
            console.log(`模拟API调用: ${url}`);
            
            // 创建fetch请求来模拟网络请求
            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Test-Header': 'test-value'
                }
            }).catch(error => {
                // 预期的错误，因为我们使用的是模拟URL
                console.log(`模拟请求完成: ${url}`);
            });

            // 设置相关的Cookie
            const domain = new URL(url, window.location.href).hostname;
            document.cookie = `api_session_${Date.now()}=session_value_${Math.random()}; path=/`;
            
            updateCookieDisplay();
        }

        // 模拟复杂场景
        function simulateComplexScenario() {
            console.log('模拟复杂场景');
            
            // 模拟登录流程
            setTimeout(() => simulateApiCall('/api/login'), 100);
            setTimeout(() => simulateApiCall('/api/auth/verify'), 200);
            setTimeout(() => simulateApiCall('/api/user/profile'), 300);
            setTimeout(() => simulateApiCall('/api/session/refresh'), 400);
            
            // 设置登录相关的Cookie
            setTimeout(() => {
                document.cookie = "login_token=complex_token_123; path=/";
                document.cookie = "user_session=user_session_456; path=/";
                updateCookieDisplay();
            }, 500);
        }

        // 模拟多个请求
        function simulateMultipleRequests() {
            console.log('模拟多个请求');
            
            const urls = [
                '/api/data/users',
                '/api/data/posts',
                '/api/data/comments',
                '/api/auth/check',
                '/api/session/validate'
            ];
            
            urls.forEach((url, index) => {
                setTimeout(() => simulateApiCall(url), index * 100);
            });
        }

        // 检查插件状态
        function checkPluginStatus() {
            const statusDiv = document.getElementById('pluginStatus');
            
            // 检查插件是否已安装
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                statusDiv.textContent = '插件状态: 已安装并运行';
                statusDiv.style.color = 'green';
            } else {
                statusDiv.textContent = '插件状态: 未检测到插件';
                statusDiv.style.color = 'red';
            }
        }

        // 导出测试规则
        function exportTestRules() {
            const testRules = {
                version: "1.0",
                exportTime: new Date().toISOString(),
                rules: [
                    {
                        key: "test-api",
                        value: "/api/",
                        type: "关键词",
                        url: "https://example.com/api/"
                    },
                    {
                        key: "test-login",
                        value: "login",
                        type: "关键词",
                        url: "https://example.com/login"
                    },
                    {
                        key: "test-exact",
                        value: "https://exact-match.example.com",
                        type: "全匹配",
                        url: "https://exact-match.example.com"
                    }
                ]
            };
            
            const jsonStr = JSON.stringify(testRules, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'test-rules.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('测试规则已导出为 test-rules.json');
        }

        // 页面加载时更新Cookie显示
        document.addEventListener('DOMContentLoaded', function() {
            updateCookieDisplay();
            checkPluginStatus();
        });
    </script>
</body>
</html>
