<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cookie Sniffer æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .api-section {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .cookie-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>ğŸª Cookie Sniffer åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>1. åŸºæœ¬Cookieæµ‹è¯•</h2>
        <p>ç‚¹å‡»æŒ‰é’®è®¾ç½®æµ‹è¯•Cookieï¼š</p>
        <button class="test-button" onclick="setTestCookie()">è®¾ç½®æµ‹è¯•Cookie</button>
        <button class="test-button" onclick="setMultipleCookies()">è®¾ç½®å¤šä¸ªCookie</button>
        <button class="test-button" onclick="clearTestCookies()">æ¸…é™¤æµ‹è¯•Cookie</button>
        <div id="cookieDisplay" class="cookie-display">å½“å‰Cookie: æ— </div>
    </div>

    <div class="test-section">
        <h2>2. APIè·¯å¾„æµ‹è¯•</h2>
        <p>æ¨¡æ‹ŸAPIè¯·æ±‚ï¼Œè¿™äº›åº”è¯¥è¢«æ’ä»¶æ•è·ï¼š</p>
        <div class="api-section">
            <h3>ç™»å½•API</h3>
            <button class="test-button" onclick="simulateApiCall('/api/login')">æ¨¡æ‹Ÿç™»å½•API</button>
            <button class="test-button" onclick="simulateApiCall('/api/auth')">æ¨¡æ‹Ÿè®¤è¯API</button>
        </div>
        <div class="api-section">
            <h3>ä¼šè¯API</h3>
            <button class="test-button" onclick="simulateApiCall('/api/session')">æ¨¡æ‹Ÿä¼šè¯API</button>
            <button class="test-button" onclick="simulateApiCall('/api/user/profile')">æ¨¡æ‹Ÿç”¨æˆ·API</button>
        </div>
    </div>

    <div class="test-section">
        <h2>3. æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•</h2>
        <p>æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼š</p>
        <button class="test-button" onclick="simulateApiCall('https://api.example.com/v1/users')">æ¨¡æ‹ŸAPI v1</button>
        <button class="test-button" onclick="simulateApiCall('https://api.example.com/v2/users')">æ¨¡æ‹ŸAPI v2</button>
        <button class="test-button" onclick="simulateApiCall('https://test.example.com/api/data')">æ¨¡æ‹Ÿæµ‹è¯•API</button>
    </div>

    <div class="test-section">
        <h2>4. å…¨åŒ¹é…æµ‹è¯•</h2>
        <p>æµ‹è¯•å®Œå…¨åŒ¹é…ï¼š</p>
        <button class="test-button" onclick="simulateApiCall('https://exact-match.example.com')">ç²¾ç¡®åŒ¹é…æµ‹è¯•</button>
        <button class="test-button" onclick="simulateApiCall('https://another-exact.example.com')">å¦ä¸€ä¸ªç²¾ç¡®åŒ¹é…</button>
    </div>

    <div class="test-section">
        <h2>5. å¤æ‚åœºæ™¯æµ‹è¯•</h2>
        <p>æ¨¡æ‹Ÿå¤æ‚çš„ç½‘ç»œè¯·æ±‚åœºæ™¯ï¼š</p>
        <button class="test-button" onclick="simulateComplexScenario()">æ¨¡æ‹Ÿå¤æ‚åœºæ™¯</button>
        <button class="test-button" onclick="simulateMultipleRequests()">æ¨¡æ‹Ÿå¤šä¸ªè¯·æ±‚</button>
    </div>

    <div class="test-section">
        <h2>6. æ’ä»¶åŠŸèƒ½éªŒè¯</h2>
        <p>éªŒè¯æ’ä»¶çš„æ–°åŠŸèƒ½ï¼š</p>
        <button class="test-button" onclick="checkPluginStatus()">æ£€æŸ¥æ’ä»¶çŠ¶æ€</button>
        <button class="test-button" onclick="exportTestRules()">å¯¼å‡ºæµ‹è¯•è§„åˆ™</button>
        <div id="pluginStatus" class="cookie-display">æ’ä»¶çŠ¶æ€: æœªæ£€æŸ¥</div>
    </div>

    <script>
        // è®¾ç½®æµ‹è¯•Cookie
        function setTestCookie() {
            document.cookie = "test_cookie=test_value_123; path=/";
            document.cookie = "session_id=abc123def456; path=/";
            updateCookieDisplay();
        }

        // è®¾ç½®å¤šä¸ªCookie
        function setMultipleCookies() {
            document.cookie = "user_id=12345; path=/";
            document.cookie = "auth_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9; path=/";
            document.cookie = "preferences=dark_mode,notifications; path=/";
            updateCookieDisplay();
        }

        // æ¸…é™¤æµ‹è¯•Cookie
        function clearTestCookies() {
            document.cookie = "test_cookie=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            document.cookie = "session_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            document.cookie = "user_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            document.cookie = "auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            document.cookie = "preferences=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
            updateCookieDisplay();
        }

        // æ›´æ–°Cookieæ˜¾ç¤º
        function updateCookieDisplay() {
            const cookies = document.cookie;
            document.getElementById('cookieDisplay').textContent = `å½“å‰Cookie: ${cookies || 'æ— '}`;
        }

        // æ¨¡æ‹ŸAPIè°ƒç”¨
        function simulateApiCall(url) {
            console.log(`æ¨¡æ‹ŸAPIè°ƒç”¨: ${url}`);
            
            // åˆ›å»ºfetchè¯·æ±‚æ¥æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Test-Header': 'test-value'
                }
            }).catch(error => {
                // é¢„æœŸçš„é”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¨¡æ‹ŸURL
                console.log(`æ¨¡æ‹Ÿè¯·æ±‚å®Œæˆ: ${url}`);
            });

            // è®¾ç½®ç›¸å…³çš„Cookie
            const domain = new URL(url, window.location.href).hostname;
            document.cookie = `api_session_${Date.now()}=session_value_${Math.random()}; path=/`;
            
            updateCookieDisplay();
        }

        // æ¨¡æ‹Ÿå¤æ‚åœºæ™¯
        function simulateComplexScenario() {
            console.log('æ¨¡æ‹Ÿå¤æ‚åœºæ™¯');
            
            // æ¨¡æ‹Ÿç™»å½•æµç¨‹
            setTimeout(() => simulateApiCall('/api/login'), 100);
            setTimeout(() => simulateApiCall('/api/auth/verify'), 200);
            setTimeout(() => simulateApiCall('/api/user/profile'), 300);
            setTimeout(() => simulateApiCall('/api/session/refresh'), 400);
            
            // è®¾ç½®ç™»å½•ç›¸å…³çš„Cookie
            setTimeout(() => {
                document.cookie = "login_token=complex_token_123; path=/";
                document.cookie = "user_session=user_session_456; path=/";
                updateCookieDisplay();
            }, 500);
        }

        // æ¨¡æ‹Ÿå¤šä¸ªè¯·æ±‚
        function simulateMultipleRequests() {
            console.log('æ¨¡æ‹Ÿå¤šä¸ªè¯·æ±‚');
            
            const urls = [
                '/api/data/users',
                '/api/data/posts',
                '/api/data/comments',
                '/api/auth/check',
                '/api/session/validate'
            ];
            
            urls.forEach((url, index) => {
                setTimeout(() => simulateApiCall(url), index * 100);
            });
        }

        // æ£€æŸ¥æ’ä»¶çŠ¶æ€
        function checkPluginStatus() {
            const statusDiv = document.getElementById('pluginStatus');
            
            // æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å®‰è£…
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                statusDiv.textContent = 'æ’ä»¶çŠ¶æ€: å·²å®‰è£…å¹¶è¿è¡Œ';
                statusDiv.style.color = 'green';
            } else {
                statusDiv.textContent = 'æ’ä»¶çŠ¶æ€: æœªæ£€æµ‹åˆ°æ’ä»¶';
                statusDiv.style.color = 'red';
            }
        }

        // å¯¼å‡ºæµ‹è¯•è§„åˆ™
        function exportTestRules() {
            const testRules = {
                version: "1.0",
                exportTime: new Date().toISOString(),
                rules: [
                    {
                        key: "test-api",
                        value: "/api/",
                        type: "å…³é”®è¯",
                        url: "https://example.com/api/"
                    },
                    {
                        key: "test-login",
                        value: "login",
                        type: "å…³é”®è¯",
                        url: "https://example.com/login"
                    },
                    {
                        key: "test-exact",
                        value: "https://exact-match.example.com",
                        type: "å…¨åŒ¹é…",
                        url: "https://exact-match.example.com"
                    }
                ]
            };
            
            const jsonStr = JSON.stringify(testRules, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'test-rules.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('æµ‹è¯•è§„åˆ™å·²å¯¼å‡ºä¸º test-rules.json');
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°Cookieæ˜¾ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            updateCookieDisplay();
            checkPluginStatus();
        });
    </script>
</body>
</html>
